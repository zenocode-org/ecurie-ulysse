---
import LazyImage from "./LazyImage.astro";
import { Carousel } from "./Carousel";
import type { ImageMetadata } from "astro";

export interface Props {
  title: string;
  price: number;
  images?: Array<ImageMetadata | string>;
  sizes?: string[];
  colors?: Array<{ name: string; value: string }>;
  className?: string;
}

const { title, price, images = [], sizes, colors, className = "" } =
  Astro.props;

const mainImage = images[0];
const hasMultipleImages = images.length > 1;

// Convert images to slides format for Carousel
const slides = images.map((image) => ({
  image,
  alt: title,
}));
---

<div
  class={`group overflow-hidden rounded-lg border border-box-border bg-box-bg dark:bg-base-dark-800 shadow-lg hover:shadow-xl transition-all duration-300 ${className}`}
>
  {mainImage && (
    <div class="relative h-64 overflow-hidden">
      {hasMultipleImages ? (
        <Carousel
          client:load
          slides={slides}
          className="h-full"
          autoplayInterval={4000}
          showDots={true}
          showArrows={true}
        />
      ) : typeof mainImage === "string" ? (
        <img
          src={mainImage}
          alt={title}
          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
          loading="lazy"
        />
      ) : (
        <LazyImage
          src={mainImage}
          alt={title}
          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
        />
      )}
    </div>
  )}
  <div class="p-6">
    <h3 class="text-xl font-semibold mb-2 text-accent dark:text-accent-light">
      {title}
    </h3>
    <div class="flex items-center justify-between mb-4">
      <span class="text-2xl font-bold text-primary-600 dark:text-primary-400">
        {price.toFixed(2)} â‚¬
      </span>
    </div>
    {sizes && sizes.length > 0 && (
      <div class="mb-3">
        <p class="text-sm text-accent-600 dark:text-accent-300 mb-2">
          Tailles:
        </p>
        <div class="flex flex-wrap gap-2">
          {sizes.map((size) => (
            <span
              class="px-3 py-1 text-sm border border-box-border rounded-md bg-box-bg dark:bg-base-dark-700"
            >
              {size}
            </span>
          ))}
        </div>
      </div>
    )}
    {colors && colors.length > 0 && (
      <div class="mb-3">
        <p class="text-sm text-accent-600 dark:text-accent-300 mb-2">
          Couleurs:
        </p>
        <div class="flex flex-wrap gap-2">
          {colors.map((color) => (
            <div
              class="flex items-center gap-2 px-3 py-1 text-sm border border-box-border rounded-md bg-box-bg dark:bg-base-dark-700"
              title={color.name}
            >
              <div
                class="w-4 h-4 rounded-full border border-box-border"
                style={`background-color: ${color.value}`}
              ></div>
              <span>{color.name}</span>
            </div>
          ))}
        </div>
      </div>
    )}
  </div>
</div>

